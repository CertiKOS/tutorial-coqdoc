<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>tutorial.stack.Stack</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library tutorial.stack.Stack</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab679"></a><h1 class="section">Stack.v</h1>

 *
<a name="lab680"></a><h1 class="section">A layer implementing a bounded stack using a bounded counter.</h1>

 
<div class="paragraph"> </div>

 Compcert helper lib 
</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.lib.Coqlib.html#"><span class="id" title="library">Coqlib</span></a>.<br/>
</div>

<div class="doc">
Compcert types and semantics 
</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.common.AST.html#"><span class="id" title="library">AST</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.lib.Integers.html#"><span class="id" title="library">Integers</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.common.Values.html#"><span class="id" title="library">Values</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.common.Globalenvs.html#"><span class="id" title="library">Globalenvs</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.cfrontend.Clight.html#"><span class="id" title="library">Clight</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.cfrontend.Ctypes.html#"><span class="id" title="library">Ctypes</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.cfrontend.Cop.html#"><span class="id" title="library">Cop</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="compcert.common.Smallstep.html#"><span class="id" title="library">Smallstep</span></a>.<br/>
</div>

<div class="doc">
CertiKOS layer library 
</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.logic.Semantics.html#"><span class="id" title="library">Semantics</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.logic.Structures.html#"><span class="id" title="library">Structures</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.compcertx.GenSem.html#"><span class="id" title="library">GenSem</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.compcertx.CGenSem.html#"><span class="id" title="library">CGenSem</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.compcertx.CPrimitives.html#"><span class="id" title="library">CPrimitives</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.simrel.SimulationRelation.html#"><span class="id" title="library">SimulationRelation</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.simrel.SimrelInvariant.html#"><span class="id" title="library">SimrelInvariant</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.logic.LayerLogicImpl.html#"><span class="id" title="library">LayerLogicImpl</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.compcertx.ClightModules.html#"><span class="id" title="library">ClightModules</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.compcertx.ClightXSemantics.html#"><span class="id" title="library">ClightXSemantics</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.simrel.AbstractData.html#"><span class="id" title="library">AbstractData</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#"><span class="id" title="library">AbstractionRelation</span></a>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="tutorial.common.TutoLib.html#"><span class="id" title="library">TutoLib</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="tutorial.stack.Counter.html#"><span class="id" title="library">Counter</span></a>.<br/>

<br/>
</div>

<div class="doc">
This file is meant to continue demonstrating how the layer calculus used in
  CertiKOS works by implementing a new layer on top of an existing one. This
  layer consists of a global stack variable <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a></span> that can be manipulated
  with <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a></span> and <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a></span> primitives as well as have its size checked with
  <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a></span>. The stack is implemented as an array where the index of the
  next open slot is tracked by the <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#COUNTER"><span class="id" title="definition">COUNTER</span></a></span> variable. This guarantees that
  one cannot <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a></span> from an empty stack or <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a></span> to a full one. The underlay
  upon which this layer is built is the <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a></span> defined in Counter.v. The
  overlay consists of the primitives described above, and an abstract state
  containing a <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a></span> of type <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a></span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a></span> with the invariant that the length of
  the stack is not greater than <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER"><span class="id" title="definition">MAX_COUNTER</span></a></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Opaque</span> <a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER"><span class="id" title="definition">MAX_COUNTER</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="get_size"><span class="id" title="definition">get_size</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 5%<span class="id" title="var">positive</span>.<br/>
<span class="id" title="keyword">Definition</span> <a name="push"><span class="id" title="definition">push</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 6%<span class="id" title="var">positive</span>.<br/>
<span class="id" title="keyword">Definition</span> <a name="pop"><span class="id" title="definition">pop</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 7%<span class="id" title="var">positive</span>.<br/>
<span class="id" title="keyword">Definition</span> <a name="STACK"><span class="id" title="definition">STACK</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 8%<span class="id" title="var">positive</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a name="Stack"><span class="id" title="section">Stack</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">Hmem</span>: <a class="idref" href="liblayers.simrel.MemWithData.html#BaseMemoryModel"><span class="id" title="class">BaseMemoryModel</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a class="idref" href="liblayers.compcertx.MakeProgramSpec.html#MakeProgram"><span class="id" title="class">MakeProgramSpec.MakeProgram</span></a>}.<br/>

<br/>
</div>

<div class="doc">
<a name="lab681"></a><h2 class="section">Abstract Data</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.AbsData"><span class="id" title="section">AbsData</span></a>.<br/>
</div>

<div class="doc">
We want our layer to abstract a stack of signed integers, so our
      abstract data will represent this as a <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a></span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a></span>. We then provide the
      initial state and our invariant and wrap it in <span class="inlinecode"><a class="idref" href="liblayers.simrel.AbstractData.html#layerdata"><span class="id" title="record">layerdata</span></a></span> as before. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a name="stack_data"><span class="id" title="record">stack_data</span></a> : <span class="id" title="keyword">Type</span> := { <a name="stack"><span class="id" title="projection">stack</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a> }.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <a name="stack_data_data_ops"><span class="id" title="instance">stack_data_data_ops</span></a> : <a class="idref" href="liblayers.simrel.AbstractData.html#AbstractDataOps"><span class="id" title="class">AbstractDataOps</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">init_data</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">{|</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">stack</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">nil</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">|};</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">data_inv</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">:=</span></a> <span class="id" title="keyword">fun</span> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">d</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">⇒</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">(</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">length</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">(</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">stack</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">d</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">)</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">≤</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">MAX_COUNTER</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">)%</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">nat</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">data_inject</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">:=</span></a> <span class="id" title="keyword">fun</span> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">f</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">d1</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">d2</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">⇒</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#Build_AbstractDataOps"><span class="id" title="constructor">True</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <a name="stack_data_data"><span class="id" title="instance">stack_data_data</span></a> : <a class="idref" href="liblayers.simrel.AbstractData.html#AbstractData"><span class="id" title="class">AbstractData</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> : <a class="idref" href="liblayers.simrel.AbstractData.html#layerdata"><span class="id" title="record">layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">ldata_type</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">stack_data</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">ldata_ops</span></a>  <a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">stack_data_data_ops</span></a><a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">ldata_prf</span></a>  <a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractData.html#ldata"><span class="id" title="constructor">stack_data_data</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.AbsData"><span class="id" title="section">AbsData</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab682"></a><h2 class="section">High Level Specifications</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.HighSpec"><span class="id" title="section">HighSpec</span></a>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a></span> returns the current number of items on the stack, which is
      just the length of the list in the abstract data. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="get_size_high_spec"><span class="id" title="definition">get_size_high_spec</span></a> (<span class="id" title="var">abs</span>: <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#abs"><span class="id" title="variable">abs</span></a>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="get_size_preserves_invariant"><span class="id" title="instance">get_size_preserves_invariant</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CGenSem.html#GenSemPreservesInvariant"><span class="id" title="class">GenSemPreservesInvariant</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_high_spec"><span class="id" title="definition">get_size_high_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? ? ? <span class="id" title="var">Hsem</span> ? ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_generic_sem</span> <span class="id" title="var">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="get_size_high_sem"><span class="id" title="definition">get_size_high_sem</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#cprimitive"><span class="id" title="record">cprimitive</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CGenSem.html#cgensem"><span class="id" title="definition">cgensem</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_high_spec"><span class="id" title="definition">get_size_high_spec</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="get_size_layer"><span class="id" title="definition">get_size_layer</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#clayer"><span class="id" title="abbreviation">clayer</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_high_sem"><span class="id" title="definition">get_size_high_sem</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a></span> needs a value to add to the stack, so the spec reflects that by
      having an additional argument after <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a></span>. As usual we encode
      the potential failure by making the return type <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a></span> <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a></span> and
      returning <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a></span> in case of an error.  N.B. The <span class="inlinecode"><a class="idref" href="compcert.flocq.Appli.Fappli_rnd_odd.html#Odd_prop_aux.x"><span class="id" title="variable">x</span></a></span> argument must come before <span class="inlinecode"><a class="idref" href="compcert.lib.Floats.html#Float32.abs"><span class="id" title="definition">abs</span></a></span> because while the type
      <span class="inlinecode"><a class="idref" href="liblayers.compcertx.GenSem.html#Zsign"><span class="id" title="inductive">Zsign</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a></span> <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a></span> is declared as an instance of
      <span class="inlinecode"><span class="id" title="var">SemOf</span></span>, <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="liblayers.compcertx.GenSem.html#Zsign"><span class="id" title="inductive">Zsign</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a></span> <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack_data"><span class="id" title="record">stack_data</span></a></span> is not.
      Also, <span class="inlinecode"><a class="idref" href="liblayers.compcertx.GenSem.html#Zsign"><span class="id" title="inductive">Zsign</span></a></span> is simply a wrapper type around <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a></span> in order to allow
      both signed and unsigned versions of <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="compcert.flocq.Appli.Fappli_IEEE.html#T"><span class="id" title="variable">T</span></a></span> to be instances of
      <span class="inlinecode"><span class="id" title="var">SemOf</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="push_high_spec"><span class="id" title="definition">push_high_spec</span></a> (<span class="id" title="var">x</span>: <a class="idref" href="liblayers.compcertx.GenSem.html#Zsign"><span class="id" title="inductive">Zsign</span></a>) (<span class="id" title="var">abs</span>: <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="liblayers.lib.Decision.html#decide"><span class="id" title="definition">decide</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#abs"><span class="id" title="variable">abs</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER"><span class="id" title="definition">MAX_COUNTER</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> {| <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">:=</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">Zsign2Z</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">x</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">::</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">(</span></a><a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">abs</span></a><a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">)</span></a> |}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="push_preserves_invariant"><span class="id" title="instance">push_preserves_invariant</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CGenSem.html#GenSemPreservesInvariant"><span class="id" title="class">GenSemPreservesInvariant</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_high_spec"><span class="id" title="definition">push_high_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? ? ? <span class="id" title="var">Hsem</span> ? ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Stack.html#push_high_spec"><span class="id" title="definition">push_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_generic_sem</span> <span class="id" title="var">Hsem</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="liblayers.lib.Decision.html#decide"><span class="id" title="definition">decide</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <span class="id" title="var">d</span>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER"><span class="id" title="definition">MAX_COUNTER</span></a>)%<span class="id" title="var">nat</span>); <span class="id" title="var">inv</span> <span class="id" title="var">H3</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="push_high_sem"><span class="id" title="definition">push_high_sem</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#cprimitive"><span class="id" title="record">cprimitive</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CGenSem.html#cgensem"><span class="id" title="definition">cgensem</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_high_spec"><span class="id" title="definition">push_high_spec</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="push_layer"><span class="id" title="definition">push_layer</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#clayer"><span class="id" title="abbreviation">clayer</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_high_sem"><span class="id" title="definition">push_high_sem</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="pop_high_spec"><span class="id" title="definition">pop_high_spec</span></a> (<span class="id" title="var">abs</span>: <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b5"><span class="id" title="notation">×</span></a> <a class="idref" href="liblayers.compcertx.GenSem.html#Zsign"><span class="id" title="inductive">Zsign</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#abs"><span class="id" title="variable">abs</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <span class="id" title="var">stack'</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">({|</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">:=</span></a> <a class="idref" href="tutorial.stack.Stack.html#Build_stack_data"><span class="id" title="constructor">stack'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">|},</span></a> <a class="idref" href="liblayers.compcertx.GenSem.html#VZS"><span class="id" title="constructor">VZS</span></a> <span class="id" title="var">x</span><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="pop_preserves_invariant"><span class="id" title="instance">pop_preserves_invariant</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CGenSem.html#GenSemPreservesInvariant"><span class="id" title="class">GenSemPreservesInvariant</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_high_spec"><span class="id" title="definition">pop_high_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? ? ? <span class="id" title="var">Hsem</span> ? <span class="id" title="var">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_generic_sem</span> <span class="id" title="var">Hsem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Stack.html#pop_high_spec"><span class="id" title="definition">pop_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <span class="id" title="var">d</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hstck</span>; <span class="id" title="var">inv</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hstck</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hinv</span>; <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="pop_high_sem"><span class="id" title="definition">pop_high_sem</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#cprimitive"><span class="id" title="record">cprimitive</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CGenSem.html#cgensem"><span class="id" title="definition">cgensem</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_high_spec"><span class="id" title="definition">pop_high_spec</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="pop_layer"><span class="id" title="definition">pop_layer</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#clayer"><span class="id" title="abbreviation">clayer</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_high_sem"><span class="id" title="definition">pop_high_sem</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.HighSpec"><span class="id" title="section">HighSpec</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab683"></a><h2 class="section">Module Implementation</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.Code"><span class="id" title="section">Code</span></a>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#f_get_size"><span class="id" title="definition">f_get_size</span></a></span> simply returns the current value of <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#COUNTER"><span class="id" title="definition">COUNTER</span></a></span> because that
      always equals the number of items on the stack. 
<div class="paragraph"> </div>

<pre>
unsigned int get_size() {
  return get_counter();
}
</pre>
 
<div class="paragraph"> </div>

 These identifiers are used as function temporaries and parameters. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="get_size_ret"><span class="id" title="definition">get_size_ret</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 9%<span class="id" title="var">positive</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="f_get_size"><span class="id" title="definition">f_get_size</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_return</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_callconv</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">cc_default</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_params</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_vars</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_temps</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">get_size_ret</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">,</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">::</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_body</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ssequence</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Scall</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Some</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">get_size_ret</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Evar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">get_counter</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Tfunction</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ctypes.Tnil</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">cc_default</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">))</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Sreturn</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Some</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Etempvar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">get_size_ret</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Program Definition</span> <a name="inlinable_f_get_size"><span class="id" title="definition">inlinable_f_get_size</span></a> : <a class="idref" href="liblayers.compcertx.ClightModules.html#function"><span class="id" title="abbreviation">function</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.ClightModules.html#inline"><span class="id" title="definition">inline</span></a> <a class="idref" href="tutorial.stack.Stack.html#f_get_size"><span class="id" title="definition">f_get_size</span></a> <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#f_push"><span class="id" title="definition">f_push</span></a></span> queries the current index with <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#get_counter"><span class="id" title="definition">get_counter</span></a></span>, moves it ahead
      with <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#incr_counter"><span class="id" title="definition">incr_counter</span></a></span>, and stores <span class="inlinecode"><a class="idref" href="compcert.flocq.Appli.Fappli_rnd_odd.html#Odd_prop_aux.x"><span class="id" title="variable">x</span></a></span> into <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a></span> at the index. It does
      not have to check whether the index is in range because <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#incr_counter"><span class="id" title="definition">incr_counter</span></a></span>
      will already fail if it is not. 
<div class="paragraph"> </div>

<pre>
void push(int x) {
  unsigned int idx = get_counter();
  incr_counter();
  STACK[idx] = x;
}
</pre>
 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="push_x"><span class="id" title="definition">push_x</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 10%<span class="id" title="var">positive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="push_idx"><span class="id" title="definition">push_idx</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 11%<span class="id" title="var">positive</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="f_push"><span class="id" title="definition">f_push</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_return</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tvoid</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_callconv</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">cc_default</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_params</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">push_x</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">,</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">::</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_vars</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_temps</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">push_idx</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">,</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">::</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_body</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ssequence</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Scall</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Some</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">push_idx</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Evar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">get_counter</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Tfunction</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ctypes.Tnil</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">cc_default</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">))</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ssequence</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Scall</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">None</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Evar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">incr_counter</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Tfunction</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ctypes.Tnil</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">cc_default</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">))</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Sassign</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ederef</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ebinop</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Oadd</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Evar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">STACK</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tarray</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Z.of_nat</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">MAX_COUNTER</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Etempvar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">push_idx</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tptr</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Etempvar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">push_x</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Program Definition</span> <a name="inlinable_f_push"><span class="id" title="definition">inlinable_f_push</span></a> : <a class="idref" href="liblayers.compcertx.ClightModules.html#function"><span class="id" title="abbreviation">function</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.ClightModules.html#inline"><span class="id" title="definition">inline</span></a> <a class="idref" href="tutorial.stack.Stack.html#f_push"><span class="id" title="definition">f_push</span></a> <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
<pre>
int pop() {
  unsigned int idx = decr_counter();
  return STACK[idx];
}
</pre>
 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="pop_idx"><span class="id" title="definition">pop_idx</span></a> : <a class="idref" href="compcert.common.AST.html#ident"><span class="id" title="definition">ident</span></a> := 12%<span class="id" title="var">positive</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="f_pop"><span class="id" title="definition">f_pop</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_return</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_callconv</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">cc_default</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_params</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_vars</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_temps</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">pop_idx</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">,</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">::</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">fn_body</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ssequence</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Scall</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Some</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">pop_idx</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Evar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">decr_counter</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Tfunction</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ctypes.Tnil</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">cc_default</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">))</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">nil</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Sreturn</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Some</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ederef</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Ebinop</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Oadd</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Evar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">STACK</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tarray</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Z.of_nat</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">MAX_COUNTER</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">Etempvar</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">pop_idx</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tuint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">(</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tptr</span></a> <a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">tint</span></a><a class="idref" href="compcert.cfrontend.Clight.html#mkfunction"><span class="id" title="constructor">)))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Program Definition</span> <a name="inlinable_f_pop"><span class="id" title="definition">inlinable_f_pop</span></a> : <a class="idref" href="liblayers.compcertx.ClightModules.html#function"><span class="id" title="abbreviation">function</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.ClightModules.html#inline"><span class="id" title="definition">inline</span></a> <a class="idref" href="tutorial.stack.Stack.html#f_pop"><span class="id" title="definition">f_pop</span></a> <span class="id" title="var">_</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Msize"><span class="id" title="definition">Msize</span></a> : <a class="idref" href="liblayers.compcertx.ClightModules.html#cmodule"><span class="id" title="abbreviation">cmodule</span></a> := <a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#inlinable_f_get_size"><span class="id" title="definition">inlinable_f_get_size</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Mpush"><span class="id" title="definition">Mpush</span></a> : <a class="idref" href="liblayers.compcertx.ClightModules.html#cmodule"><span class="id" title="abbreviation">cmodule</span></a> := <a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#inlinable_f_push"><span class="id" title="definition">inlinable_f_push</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="Mpop"><span class="id" title="definition">Mpop</span></a> : <a class="idref" href="liblayers.compcertx.ClightModules.html#cmodule"><span class="id" title="abbreviation">cmodule</span></a> := <a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#inlinable_f_pop"><span class="id" title="definition">inlinable_f_pop</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.Code"><span class="id" title="section">Code</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab684"></a><h2 class="section">Low Level Specifications</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.LowSpec"><span class="id" title="section">LowSpec</span></a>.<br/>

<br/>
</div>

<div class="doc">
Because this layer is built on top of the counter layer, we can write
      the low level specs in terms of primitives from <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a></span> instead of
      dealing with the memory directly. This simplifies both the specification
      and the refinement proofs. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="get_size_csig"><span class="id" title="definition">get_size_csig</span></a> := <a class="idref" href="liblayers.compcertx.CompcertStructures.html#mkcsig"><span class="id" title="definition">mkcsig</span></a> <a class="idref" href="compcert.cfrontend.Ctypes.html#Tnil"><span class="id" title="constructor">Ctypes.Tnil</span></a> <a class="idref" href="tutorial.common.TutoLib.html#tuint"><span class="id" title="abbreviation">tuint</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a name="get_size_step"><span class="id" title="inductive">get_size_step</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CompcertStructures.html#csignature"><span class="id" title="record">csignature</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="compcert.common.Values.html#val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b5"><span class="id" title="notation">×</span></a> <a class="idref" href="liblayers.simrel.MemWithData.html#mwd"><span class="id" title="definition">mwd</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="compcert.common.Values.html#val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b5"><span class="id" title="notation">×</span></a> <a class="idref" href="liblayers.simrel.MemWithData.html#mwd"><span class="id" title="definition">mwd</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a name="get_size_step_intro"><span class="id" title="constructor">get_size_step_intro</span></a> <span class="id" title="var">m</span> <span class="id" title="var">d</span> <span class="id" title="var">sb</span> <span class="id" title="var">sz</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
The <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a></span> global variable is stored at some memory block <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#sb"><span class="id" title="variable">sb</span></a></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">HSb</span>: <a class="idref" href="liblayers.compcertx.CompcertStructures.html#find_symbol"><span class="id" title="definition">find_symbol</span></a> <a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="tutorial.stack.Stack.html#sb"><span class="id" title="variable">sb</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
Because we have access to the counter layer abstract data, we
          can read the counter value using the <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#get_counter"><span class="id" title="definition">get_counter</span></a></span> high level
          spec instead of loading from memory 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Counter.html#get_counter_high_spec"><span class="id" title="definition">get_counter_high_spec</span></a> <a class="idref" href="tutorial.stack.Stack.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> (<a class="idref" href="compcert.lib.Integers.html#Int.unsigned"><span class="id" title="definition">Int.unsigned</span></a> <a class="idref" href="tutorial.stack.Stack.html#sz"><span class="id" title="variable">sz</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a></span> takes no arguments, returns <span class="inlinecode"><a class="idref" href="compcert.common.Linking.html#sz"><span class="id" title="variable">sz</span></a></span>, and does not change
          memory or abstract state 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#get_size_step"><span class="id" title="inductive">get_size_step</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_csig"><span class="id" title="definition">get_size_csig</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#d"><span class="id" title="variable">d</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <a class="idref" href="tutorial.stack.Stack.html#sz"><span class="id" title="variable">sz</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#d"><span class="id" title="variable">d</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">))</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="push_csig"><span class="id" title="definition">push_csig</span></a> := <a class="idref" href="liblayers.compcertx.CompcertStructures.html#mkcsig"><span class="id" title="definition">mkcsig</span></a> (<a class="idref" href="tutorial.common.TutoLib.html#type_of_list_type"><span class="id" title="definition">type_of_list_type</span></a> (<a class="idref" href="tutorial.common.TutoLib.html#tint"><span class="id" title="abbreviation">tint</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)) <a class="idref" href="tutorial.common.TutoLib.html#tvoid"><span class="id" title="abbreviation">tvoid</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a name="push_step"><span class="id" title="inductive">push_step</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CompcertStructures.html#csignature"><span class="id" title="record">csignature</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="compcert.common.Values.html#val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b5"><span class="id" title="notation">×</span></a> <a class="idref" href="liblayers.simrel.MemWithData.html#mwd"><span class="id" title="definition">mwd</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="compcert.common.Values.html#val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b5"><span class="id" title="notation">×</span></a> <a class="idref" href="liblayers.simrel.MemWithData.html#mwd"><span class="id" title="definition">mwd</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a name="push_step_intro"><span class="id" title="constructor">push_step_intro</span></a> <span class="id" title="var">m</span> <span class="id" title="var">d</span> <span class="id" title="var">sb</span> <span class="id" title="var">d'</span> <span class="id" title="var">m'</span> <span class="id" title="var">idx</span> <span class="id" title="var">idx'</span> <span class="id" title="var">x</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
The <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a></span> global variable is stored at some memory block <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#sb"><span class="id" title="variable">sb</span></a></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">HSb</span>: <a class="idref" href="liblayers.compcertx.CompcertStructures.html#find_symbol"><span class="id" title="definition">find_symbol</span></a> <a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="tutorial.stack.Stack.html#sb"><span class="id" title="variable">sb</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
We again use the high level spec of a counter layer primitive 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Counter.html#get_counter_high_spec"><span class="id" title="definition">get_counter_high_spec</span></a> <a class="idref" href="tutorial.stack.Stack.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> (<a class="idref" href="compcert.lib.Integers.html#Int.unsigned"><span class="id" title="definition">Int.unsigned</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
We can also use the high level spec for <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#incr_counter"><span class="id" title="definition">incr_counter</span></a></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Counter.html#incr_counter_high_spec"><span class="id" title="definition">incr_counter_high_spec</span></a> <a class="idref" href="tutorial.stack.Stack.html#d"><span class="id" title="variable">d</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#d'"><span class="id" title="variable">d'</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.to_nat"><span class="id" title="definition">Z.to_nat</span></a> (<a class="idref" href="compcert.lib.Integers.html#Int.unsigned"><span class="id" title="definition">Int.unsigned</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx'"><span class="id" title="variable">idx'</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
Storing <span class="inlinecode"><a class="idref" href="compcert.flocq.Appli.Fappli_rnd_odd.html#Odd_prop_aux.x"><span class="id" title="variable">x</span></a></span> at <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a>[<a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a>]</span> returns some new memory <span class="inlinecode"><a class="idref" href="compcert.cfrontend.Cop.html#WITHMEMORYMODEL.GENERIC_INJECTION.m'"><span class="id" title="variable">m'</span></a></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.common.Memtype.html#Mem.store"><span class="id" title="method">Mem.store</span></a> <a class="idref" href="compcert.common.AST.html#Mint32"><span class="id" title="constructor">Mint32</span></a> <a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="tutorial.stack.Stack.html#sb"><span class="id" title="variable">sb</span></a> (4 <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#88e34ed7a73f02772126289867960764"><span class="id" title="notation">×</span></a> <a class="idref" href="compcert.lib.Integers.html#Int.unsigned"><span class="id" title="definition">Int.unsigned</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a>) (<a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="tutorial.stack.Stack.html#m'"><span class="id" title="variable">m'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a></span> takes one argument, returns nothing and changes both the
          memory and abstract state 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#push_step"><span class="id" title="inductive">push_step</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_csig"><span class="id" title="definition">push_csig</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">((</span></a><a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">),</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#d"><span class="id" title="variable">d</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="compcert.common.Values.html#Vundef"><span class="id" title="constructor">Vundef</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#m'"><span class="id" title="variable">m'</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#d'"><span class="id" title="variable">d'</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">))</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="pop_csig"><span class="id" title="definition">pop_csig</span></a> := <a class="idref" href="liblayers.compcertx.CompcertStructures.html#mkcsig"><span class="id" title="definition">mkcsig</span></a> <a class="idref" href="compcert.cfrontend.Ctypes.html#Tnil"><span class="id" title="constructor">Ctypes.Tnil</span></a> <a class="idref" href="tutorial.common.TutoLib.html#tint"><span class="id" title="abbreviation">tint</span></a>.<br/>

<br/>
</div>

<div class="doc">
TUTORIAL: Replace the False premises in <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#pop_step_intro"><span class="id" title="constructor">pop_step_intro</span></a></span> with correct premises 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a name="pop_step"><span class="id" title="inductive">pop_step</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CompcertStructures.html#csignature"><span class="id" title="record">csignature</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="compcert.common.Values.html#val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b5"><span class="id" title="notation">×</span></a> <a class="idref" href="liblayers.simrel.MemWithData.html#mwd"><span class="id" title="definition">mwd</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="compcert.common.Values.html#val"><span class="id" title="inductive">val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b5"><span class="id" title="notation">×</span></a> <a class="idref" href="liblayers.simrel.MemWithData.html#mwd"><span class="id" title="definition">mwd</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a name="pop_step_intro"><span class="id" title="constructor">pop_step_intro</span></a> <span class="id" title="var">m</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">x</span> <span class="id" title="var">sb</span> (<span class="id" title="var">idx</span> : <a class="idref" href="compcert.lib.Integers.html#int"><span class="id" title="abbreviation">int</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">HSb</span>: <a class="idref" href="liblayers.compcertx.CompcertStructures.html#find_symbol"><span class="id" title="definition">find_symbol</span></a> <a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="tutorial.stack.Stack.html#sb"><span class="id" title="variable">sb</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#pop_step"><span class="id" title="inductive">pop_step</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_csig"><span class="id" title="definition">pop_csig</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#d"><span class="id" title="variable">d</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#d'"><span class="id" title="variable">d'</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#44400027531d4bc3f586a1997dc874c0"><span class="id" title="notation">))</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="get_size_cprimitive"><span class="id" title="definition">get_size_cprimitive</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#cprimitive"><span class="id" title="record">cprimitive</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="var">mkcprim_tac</span> <a class="idref" href="tutorial.stack.Stack.html#get_size_step"><span class="id" title="inductive">get_size_step</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_csig"><span class="id" title="definition">get_size_csig</span></a>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="push_cprimitive"><span class="id" title="definition">push_cprimitive</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#cprimitive"><span class="id" title="record">cprimitive</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="var">mkcprim_tac</span> <a class="idref" href="tutorial.stack.Stack.html#push_step"><span class="id" title="inductive">push_step</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_csig"><span class="id" title="definition">push_csig</span></a>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="pop_cprimitive"><span class="id" title="definition">pop_cprimitive</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#cprimitive"><span class="id" title="record">cprimitive</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="var">mkcprim_tac</span> <a class="idref" href="tutorial.stack.Stack.html#pop_step"><span class="id" title="inductive">pop_step</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_csig"><span class="id" title="definition">pop_csig</span></a>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
We will find out later in this file that the code proof of <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a></span> will
      make use of the invariants of the counter layer. This will require that
      we show that the low level specs preserve these invariants. More
      explanation later on. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="get_size_cprim_pres_inv"><span class="id" title="instance">get_size_cprim_pres_inv</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CPrimitives.html#CPrimitivePreservesInvariant"><span class="id" title="class">CPrimitivePreservesInvariant</span></a> <span class="id" title="var">_</span> <a class="idref" href="tutorial.stack.Stack.html#get_size_cprimitive"><span class="id" title="definition">get_size_cprimitive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="push_cprim_pres_inv"><span class="id" title="instance">push_cprim_pres_inv</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CPrimitives.html#CPrimitivePreservesInvariant"><span class="id" title="class">CPrimitivePreservesInvariant</span></a> <span class="id" title="var">_</span> <a class="idref" href="tutorial.stack.Stack.html#push_cprimitive"><span class="id" title="definition">push_cprimitive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#incr_counter_high_spec"><span class="id" title="definition">incr_counter_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destr_in</span> <span class="id" title="var">H10</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">H1</span>. <span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">cprimitive_inv_init_state_data_inv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="compcert.common.Memtype.html#Mem.store_valid_block_1"><span class="id" title="method">Mem.store_valid_block_1</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> <a class="idref" href="compcert.common.Memtype.html#Mem.nextblock_store"><span class="id" title="method">Mem.nextblock_store</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="compcert.common.Memtype.html#Mem.store_inject_neutral"><span class="id" title="method">Mem.store_inject_neutral</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="liblayers.compcertx.CompcertStructures.html#find_symbol_block_is_global"><span class="id" title="lemma">find_symbol_block_is_global</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">HSb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">cprimitive_inv_init_state_valid</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HSb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="compcert.common.Memtype.html#Mem.nextblock_store"><span class="id" title="method">Mem.nextblock_store</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H11</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H11</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="pop_cprim_pres_inv"><span class="id" title="instance">pop_cprim_pres_inv</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CPrimitives.html#CPrimitivePreservesInvariant"><span class="id" title="class">CPrimitivePreservesInvariant</span></a> <span class="id" title="var">_</span> <a class="idref" href="tutorial.stack.Stack.html#pop_cprimitive"><span class="id" title="definition">pop_cprimitive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#decr_counter_high_spec"><span class="id" title="definition">decr_counter_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H5</span>.<br/>
</div>

<div class="doc">
TUTORIAL: Finish this proof that <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#pop_step"><span class="id" title="inductive">pop_step</span></a></span> preserves its layer invariant 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.LowSpec"><span class="id" title="section">LowSpec</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab685"></a><h2 class="section">Code Proofs</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.CodeLowSpecSim"><span class="id" title="section">CodeLowSpecSim</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">ce</span>: <a class="idref" href="liblayers.compcertx.ClightXSemantics.html#ClightCompositeEnv"><span class="id" title="class">ClightCompositeEnv</span></a>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="get_size_code"><span class="id" title="lemma">get_size_code</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">⊢</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="liblayers.logic.Structures.html#id"><span class="id" title="method">id</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#Msize"><span class="id" title="definition">Msize</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">:</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_cprimitive"><span class="id" title="definition">get_size_cprimitive</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">code_proof_tac</span>.<br/>
</div>

<div class="doc">
We will need the function pointer for the following primitive later
         on. This tactic pulls it out of the layer and into the current
         context. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_prim</span> <a class="idref" href="tutorial.stack.Counter.html#get_counter"><span class="id" title="definition">get_counter</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">CStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cprim_step</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="var">step_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="push_code"><span class="id" title="lemma">push_code</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">⊢</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="liblayers.logic.Structures.html#id"><span class="id" title="method">id</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#Mpush"><span class="id" title="definition">Mpush</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">:</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_cprimitive"><span class="id" title="definition">push_cprimitive</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Opaque</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.mul"><span class="id" title="definition">Z.mul</span></a>. </div>

<div class="doc">
so (4 * _) not unfolded 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">code_proof_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_prim</span> <a class="idref" href="tutorial.stack.Counter.html#get_counter"><span class="id" title="definition">get_counter</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_prim</span> <a class="idref" href="tutorial.stack.Counter.html#incr_counter"><span class="id" title="definition">incr_counter</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">CStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#incr_counter_high_spec"><span class="id" title="definition">incr_counter_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H8</span>. <span class="id" title="var">destr_in</span> <span class="id" title="var">H8</span>; <span class="id" title="var">inv</span> <span class="id" title="var">H8</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hidx</span>: <a class="idref" href="compcert.lib.Integers.html#Int.unsigned"><span class="id" title="definition">Int.unsigned</span></a> <span class="id" title="var">idx</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> (<a class="idref" href="tutorial.stack.Counter.html#counter"><span class="id" title="projection">counter</span></a> <span class="id" title="var">d</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">generalize</span> (<a class="idref" href="compcert.lib.Integers.html#Int.unsigned_range"><span class="id" title="lemma">Int.unsigned_range</span></a> <span class="id" title="var">idx</span>); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#get_counter_high_spec"><span class="id" title="definition">get_counter_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.Znat.html#Z2Nat.id"><span class="id" title="lemma">Z2Nat.id</span></a> (<a class="idref" href="compcert.lib.Integers.html#Int.unsigned"><span class="id" title="definition">Int.unsigned</span></a> <span class="id" title="var">_</span>)); <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cprim_step</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="var">step_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- </div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#get_counter"><span class="id" title="definition">get_counter</span></a></span> return value 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- </div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#incr_counter"><span class="id" title="definition">incr_counter</span></a></span> return value 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#incr_counter_high_spec"><span class="id" title="definition">incr_counter_high_spec</span></a>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqs</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- </div>

<div class="doc">
Storing into <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER_range"><span class="id" title="axiom">MAX_COUNTER_range</span></a> <span class="id" title="keyword">as</span> <span class="id" title="var">Hmc_range</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <a class="idref" href="tutorial.common.TutoLib.html#int_ptrofs_max"><span class="id" title="lemma">int_ptrofs_max</span></a> <span class="id" title="keyword">as</span> <span class="id" title="var">Hint_ptr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="liblayers.lib.Lift.html#lift"><span class="id" title="method">lift</span></a>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="compcert.lib.Integers.html#Ptrofs.add_zero_l"><span class="id" title="lemma">Ptrofs.add_zero_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="compcert.lib.Integers.html#Ptrofs.mul"><span class="id" title="definition">Ptrofs.mul</span></a>, <a class="idref" href="compcert.lib.Integers.html#Ptrofs.of_intu"><span class="id" title="definition">Ptrofs.of_intu</span></a>, <a class="idref" href="compcert.lib.Integers.html#Ptrofs.of_int"><span class="id" title="definition">Ptrofs.of_int</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="compcert.lib.Integers.html#Ptrofs.unsigned_repr"><span class="id" title="lemma">Ptrofs.unsigned_repr</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H9</span>, <span class="id" title="var">H2</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
In order to prove that <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#f_pop"><span class="id" title="definition">f_pop</span></a></span> is correct with respect to its low spec,
      we need to know that the <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span> returned by <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#get_counter"><span class="id" title="definition">get_counter</span></a></span> is bounded
      above by <span class="inlinecode"><span class="id" title="var">Int.max_unsigned</span></span>. In the proof of <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#f_push"><span class="id" title="definition">f_push</span></a></span> this wasn't a
      problem because we use <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#incr_counter"><span class="id" title="definition">incr_counter</span></a></span> which gives us the tighter upper
      bound of <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span> <span class="inlinecode">≤</span> <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER"><span class="id" title="definition">MAX_COUNTER</span></a></span>, and we also know that
      <span class="inlinecode">4</span> <span class="inlinecode">×</span> <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER"><span class="id" title="definition">MAX_COUNTER</span></a></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">Int.max_unsigned</span></span>. With <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#f_pop"><span class="id" title="definition">f_pop</span></a></span> however, we call
      <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#decr_counter"><span class="id" title="definition">decr_counter</span></a></span>, which only gives us a lower bound of <span class="inlinecode">0</span> <span class="inlinecode">≤</span> <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span>.
      Fortunately, the invariant of the counter layer is that
      <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#counter"><span class="id" title="projection">counter</span></a></span> <span class="inlinecode">≤</span> <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER"><span class="id" title="definition">MAX_COUNTER</span></a></span>. However, in order to use this fact, we have to
      strengthen our simulation diagram to reflect the fact that if the
      invariant holds in the initial states, it is preserved in the final
      state. This means we have to show that the semantics of the Clight
      function <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#f_pop"><span class="id" title="definition">f_pop</span></a></span> evaluated on <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a></span> preserves the invariants
      of <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a></span>. As it turns out, it is sufficient to show that all of the
      primitives in <span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a></span> preserve the invariant due to the monotonicity
      of the semantics. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="pop_code"><span class="id" title="lemma">pop_code</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">⊢</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="liblayers.simrel.SimrelInvariant.html#inv"><span class="id" title="definition">inv</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Stack.html#Mpop"><span class="id" title="definition">Mpop</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">:</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_cprimitive"><span class="id" title="definition">pop_cprimitive</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">code_proof_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- </div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="tutorial.stack.Counter.html#counter_L"><span class="id" title="definition">counter_L</span></a></span> preserves invariants 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="tutorial.stack.Counter.html#counter_pres_inv"><span class="id" title="lemma">counter_pres_inv</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- </div>

<div class="doc">
simulation where invariant holds for the initial state 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_prim</span> <a class="idref" href="tutorial.stack.Counter.html#decr_counter"><span class="id" title="definition">decr_counter</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">Hmatch</span>; <span class="id" title="var">inv</span> <span class="id" title="var">CStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">H3</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hidx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#decr_counter_high_spec"><span class="id" title="definition">decr_counter_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hidx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.CodeLowSpecSim"><span class="id" title="section">CodeLowSpecSim</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab686"></a><h2 class="section">Layer Relation</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.LowHighSpecRel"><span class="id" title="section">LowHighSpecRel</span></a>.<br/>

<br/>
</div>

<div class="doc">
We relate the overlay's abstract data and the underlay's concrete
      memory by requiring that for every item in the abstract <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a></span>, the
      same item can be found at the appropriate place in memory. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a name="match_stack"><span class="id" title="inductive">match_stack</span></a> : <a class="idref" href="liblayers.simrel.MemWithData.html#mem"><span class="id" title="method">mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="compcert.common.Values.html#block"><span class="id" title="definition">block</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a name="match_stack_nil"><span class="id" title="constructor">match_stack_nil</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">m</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a name="match_stack_intro"><span class="id" title="constructor">match_stack_intro</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">m</span> <span class="id" title="var">b</span> <span class="id" title="var">idx</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.common.Memtype.html#Mem.load"><span class="id" title="method">Mem.load</span></a> <a class="idref" href="compcert.common.AST.html#Mint32"><span class="id" title="constructor">Mint32</span></a> <a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> (4 <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#88e34ed7a73f02772126289867960764"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> (<a class="idref" href="compcert.lib.Integers.html#Int.repr"><span class="id" title="definition">Int.repr</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a> <a class="idref" href="tutorial.stack.Stack.html#s"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a>) (<a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="tutorial.stack.Stack.html#s"><span class="id" title="variable">s</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a name="match_data"><span class="id" title="inductive">match_data</span></a> : <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.simrel.MemWithData.html#mem"><span class="id" title="method">mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a name="match_data_intro"><span class="id" title="constructor">match_data_intro</span></a> <span class="id" title="var">b</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">m</span> (<span class="id" title="var">abs</span>: <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.compcertx.CompcertStructures.html#find_symbol"><span class="id" title="definition">find_symbol</span></a> <a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#abs"><span class="id" title="variable">abs</span></a>)) (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#abs"><span class="id" title="variable">abs</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_data"><span class="id" title="inductive">match_data</span></a> <a class="idref" href="tutorial.stack.Stack.html#abs"><span class="id" title="variable">abs</span></a> <a class="idref" href="tutorial.stack.Stack.html#m"><span class="id" title="variable">m</span></a>.<br/>

<br/>
</div>

<div class="doc">
This time our relation between the high and low abstract data is not
      empty. We require that the size of the stack is equal to the value of
      the counter. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a name="relate_data"><span class="id" title="record">relate_data</span></a> (<span class="id" title="var">hadt</span>: <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a>) (<span class="id" title="var">ladt</span>: <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="mkrelate_data"><span class="id" title="constructor">mkrelate_data</span></a> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="stack_counter_len"><span class="id" title="projection">stack_counter_len</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#hadt"><span class="id" title="variable">hadt</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter"><span class="id" title="projection">counter</span></a> <a class="idref" href="tutorial.stack.Stack.html#ladt"><span class="id" title="variable">ladt</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="abrel_components_stack_counter"><span class="id" title="definition">abrel_components_stack_counter</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#abrel_components"><span class="id" title="record">abrel_components</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">abrel_relate</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">relate_data</span></a><a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">abrel_match</span></a>  <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">match_data</span></a><a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">abrel_new_glbl</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">(</span></a><a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">STACK</span></a><a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">,</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">Init_space</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">(4</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">×</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">Z.of_nat</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">MAX_COUNTER</span></a><a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">)</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">::</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">nil</span></a><a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">)</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">::</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel_components"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="rel_ops"><span class="id" title="instance">rel_ops</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#AbstractionRelation"><span class="id" title="class">AbstractionRelation</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="tutorial.stack.Stack.html#abrel_components_stack_counter"><span class="id" title="definition">abrel_components_stack_counter</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_abrel_init_props</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">red</span>; <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> (<a class="idref" href="tutorial.stack.Stack.html#stack"><span class="id" title="projection">stack</span></a> <span class="id" title="var">a</span>); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">inv</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="compcert.common.Memtype.html#Mem.load_unchanged_on"><span class="id" title="method">Mem.load_unchanged_on</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">red</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <a class="idref" href="tutorial.stack.Stack.html#STACK"><span class="id" title="definition">STACK</span></a>; <span class="id" title="tactic">eexists</span>. <span class="id" title="var">cbn</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">decision</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="abrel_stack_counter"><span class="id" title="definition">abrel_stack_counter</span></a> : <a class="idref" href="liblayers.simrel.AbstractionRelation.html#abrel"><span class="id" title="record">abrel</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel"><span class="id" title="constructor">abrel_ops</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel"><span class="id" title="constructor">abrel_components_stack_counter</span></a><a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel"><span class="id" title="constructor">abrel_prf</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel"><span class="id" title="constructor">:=</span></a> <a class="idref" href="liblayers.simrel.AbstractionRelation.html#Build_abrel"><span class="id" title="constructor">rel_ops</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="stack_R"><span class="id" title="definition">stack_R</span></a> : <a class="idref" href="liblayers.simrel.SimrelDefinition.html#simrel"><span class="id" title="record">simrel</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> := <a class="idref" href="liblayers.simrel.AbstractionRelation.html#abrel_simrel"><span class="id" title="definition">abrel_simrel</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="tutorial.stack.Stack.html#abrel_stack_counter"><span class="id" title="definition">abrel_stack_counter</span></a>.<br/>

<br/>
</div>

<div class="doc">
These lemmas about <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a></span> will be useful later to show that the
      relation still holds after pushing a new item to the stack. 
<div class="paragraph"> </div>

 If two memories <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m1"><span class="id" title="variable">m1</span></a></span> and <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m2"><span class="id" title="variable">m2</span></a></span> have the same values at every offset
      below some <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span>, and the <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a></span> relation holds for stack <span class="inlinecode"><a class="idref" href="compcert.common.Errors.html#s"><span class="id" title="variable">s</span></a></span> on
      <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m1"><span class="id" title="variable">m1</span></a></span> up to <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span>, then <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a></span> also holds for <span class="inlinecode"><a class="idref" href="compcert.common.Errors.html#s"><span class="id" title="variable">s</span></a></span> on <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m2"><span class="id" title="variable">m2</span></a></span> up to
      <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="match_stack_load_same"><span class="id" title="lemma">match_stack_load_same</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">b</span> <span class="id" title="var">idx</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <span class="id" title="var">idx'</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="tutorial.stack.Stack.html#idx'"><span class="id" title="variable">idx'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de8"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.common.Memtype.html#Mem.load"><span class="id" title="method">Mem.load</span></a> <a class="idref" href="compcert.common.AST.html#Mint32"><span class="id" title="constructor">Mint32</span></a> <a class="idref" href="tutorial.stack.Stack.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> (4 <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#88e34ed7a73f02772126289867960764"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx'"><span class="id" title="variable">idx'</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.common.Memtype.html#Mem.load"><span class="id" title="method">Mem.load</span></a> <a class="idref" href="compcert.common.AST.html#Mint32"><span class="id" title="constructor">Mint32</span></a> <a class="idref" href="tutorial.stack.Stack.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> (4 <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#88e34ed7a73f02772126289867960764"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx'"><span class="id" title="variable">idx'</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a> <a class="idref" href="tutorial.stack.Stack.html#s"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a> <a class="idref" href="tutorial.stack.Stack.html#s"><span class="id" title="variable">s</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a></span> holds for stack <span class="inlinecode"><a class="idref" href="compcert.common.Errors.html#s"><span class="id" title="variable">s</span></a></span> on <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m1"><span class="id" title="variable">m1</span></a></span> up to <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span>, and <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m2"><span class="id" title="variable">m2</span></a></span> is
      the result of storing <span class="inlinecode"><a class="idref" href="compcert.flocq.Appli.Fappli_rnd_odd.html#Odd_prop_aux.x"><span class="id" title="variable">x</span></a></span> at <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span> in <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m1"><span class="id" title="variable">m1</span></a></span>, then <span class="inlinecode"><a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a></span> holds for
      <span class="inlinecode"><a class="idref" href="compcert.flocq.Appli.Fappli_rnd_odd.html#Odd_prop_aux.x"><span class="id" title="variable">x</span></a></span> pushed onto <span class="inlinecode"><a class="idref" href="compcert.common.Errors.html#s"><span class="id" title="variable">s</span></a></span> on <span class="inlinecode"><a class="idref" href="compcert.x86.Op.html#EVAL_COMPAT.m2"><span class="id" title="variable">m2</span></a></span> up to <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#idx"><span class="id" title="variable">idx</span></a></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="match_stack_store"><span class="id" title="lemma">match_stack_store</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">b</span> <span class="id" title="var">idx</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a> <a class="idref" href="tutorial.stack.Stack.html#s"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="compcert.common.Memtype.html#Mem.store"><span class="id" title="method">Mem.store</span></a> <a class="idref" href="compcert.common.AST.html#Mint32"><span class="id" title="constructor">Mint32</span></a> <a class="idref" href="tutorial.stack.Stack.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> (4 <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#88e34ed7a73f02772126289867960764"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a>) (<a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="tutorial.stack.Stack.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#match_stack"><span class="id" title="inductive">match_stack</span></a> <a class="idref" href="tutorial.stack.Stack.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="tutorial.stack.Stack.html#b"><span class="id" title="variable">b</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">Datatypes.S</span></a> <a class="idref" href="tutorial.stack.Stack.html#idx"><span class="id" title="variable">idx</span></a>) (<a class="idref" href="compcert.lib.Integers.html#Int.signed"><span class="id" title="definition">Int.signed</span></a> <a class="idref" href="tutorial.stack.Stack.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed5"><span class="id" title="notation">::</span></a> <a class="idref" href="tutorial.stack.Stack.html#s"><span class="id" title="variable">s</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="compcert.lib.Integers.html#Int.repr_signed"><span class="id" title="lemma">Int.repr_signed</span></a>. <span class="id" title="tactic">eapply</span> <a class="idref" href="compcert.common.Memtype.html#Mem.load_store_same"><span class="id" title="method">Mem.load_store_same</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> (<a class="idref" href="tutorial.stack.Stack.html#match_stack_load_same"><span class="id" title="lemma">match_stack_load_same</span></a> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<a class="idref" href="compcert.common.Memtype.html#Mem.load_store_other"><span class="id" title="method">Mem.load_store_other</span></a> <a class="idref" href="compcert.common.AST.html#Mint32"><span class="id" title="constructor">Mint32</span></a> <span class="id" title="var">m1</span> <span class="id" title="var">b</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">m2</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.Znat.html#Nat2Z.inj_succ"><span class="id" title="lemma">Nat2Z.inj_succ</span></a>. <span class="id" title="tactic">unfold</span> <a class="idref" href="compcert.common.Memdata.html#size_chunk"><span class="id" title="definition">size_chunk</span></a>. <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.LowHighSpecRel"><span class="id" title="section">LowHighSpecRel</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab687"></a><h2 class="section">Refinement Proofs</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.LowHighSpecSim"><span class="id" title="section">LowHighSpecSim</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">ce</span>: <a class="idref" href="liblayers.compcertx.ClightXSemantics.html#ClightCompositeEnv"><span class="id" title="class">ClightCompositeEnv</span></a>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="get_size_refine"><span class="id" title="lemma">get_size_refine</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_cprimitive"><span class="id" title="definition">get_size_cprimitive</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">⊢</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#stack_R"><span class="id" title="definition">stack_R</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">,</span></a> <a class="idref" href="liblayers.logic.Structures.html#1bcfff782645e550303b44d1d50df7a5"><span class="id" title="notation">∅</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">:</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_layer"><span class="id" title="definition">get_size_layer</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">refine_proof_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">CStep</span>. <span class="id" title="var">inv_generic_sem</span> <span class="id" title="var">H8</span>. <span class="id" title="var">inv_monad</span> <span class="id" title="var">H0</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverse_hyps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">MemRel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">abrel_match_mem_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">abrel_match_mem_relate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Stack.html#get_size_high_spec"><span class="id" title="definition">get_size_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#get_counter_high_spec"><span class="id" title="definition">get_counter_high_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">stack_counter_len0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="push_refine"><span class="id" title="lemma">push_refine</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_cprimitive"><span class="id" title="definition">push_cprimitive</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">⊢</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#stack_R"><span class="id" title="definition">stack_R</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">,</span></a> <a class="idref" href="liblayers.logic.Structures.html#1bcfff782645e550303b44d1d50df7a5"><span class="id" title="notation">∅</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">:</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_layer"><span class="id" title="definition">push_layer</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Opaque</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.mul"><span class="id" title="definition">Z.mul</span></a>. </div>

<div class="doc">
here again to prevent cbn expanding 4 * _ 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">refine_proof_tac</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">CStep</span>. <span class="id" title="var">inv_generic_sem</span> <span class="id" title="var">H8</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H0</span>. <span class="id" title="var">inv_monad</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inverse_hyps</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">MemRel</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">abrel_match_mem_match</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv</span> <span class="id" title="var">abrel_match_mem_relate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Stack.html#push_high_spec"><span class="id" title="definition">push_high_spec</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destr_in</span> <span class="id" title="var">H2</span>; <span class="id" title="var">inv</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="compcert.common.Memtype.html#Mem.valid_access_store"><span class="id" title="lemma">Mem.valid_access_store</span></a> <span class="id" title="var">ym</span> <a class="idref" href="compcert.common.AST.html#Mint32"><span class="id" title="constructor">Mint32</span></a> <span class="id" title="var">b</span> (4 <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#88e34ed7a73f02772126289867960764"><span class="id" title="notation">×</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> (<a class="idref" href="tutorial.stack.Counter.html#counter"><span class="id" title="projection">counter</span></a> <span class="id" title="var">yd</span>)) (<a class="idref" href="compcert.common.Values.html#Vint"><span class="id" title="constructor">Vint</span></a> <span class="id" title="var">i</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> (<span class="id" title="var">m'</span> &amp; <span class="id" title="var">Hstore</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> (<span class="id" title="var">abrel_match_mem_perms</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> 0 <a class="idref" href="compcert.common.Memtype.html#Cur"><span class="id" title="constructor">Cur</span></a> <a class="idref" href="compcert.common.Memtype.html#Writable"><span class="id" title="constructor">Writable</span></a>) <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.add_0_r"><span class="id" title="lemma">Z.add_0_r</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.Zmax.html#Zmax_left"><span class="id" title="lemma">Zmax_left</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; [| <span class="id" title="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.divide_factor_l"><span class="id" title="lemma">Z.divide_factor_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">generalize</span> <a class="idref" href="tutorial.stack.Counter.html#MAX_COUNTER_range"><span class="id" title="axiom">MAX_COUNTER_range</span></a>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#get_counter_high_spec"><span class="id" title="definition">get_counter_high_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.Znat.html#Nat2Z.id"><span class="id" title="lemma">Nat2Z.id</span></a> (<a class="idref" href="tutorial.stack.Counter.html#counter"><span class="id" title="projection">counter</span></a> <span class="id" title="var">_</span>)); <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="compcert.lib.Integers.html#Int.unsigned_repr"><span class="id" title="lemma">Int.unsigned_repr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <span class="id" title="var">_</span>)); [<span class="id" title="tactic">reflexivity</span> | <span class="id" title="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Counter.html#incr_counter_high_spec"><span class="id" title="definition">incr_counter_high_spec</span></a>. <span class="id" title="var">destr</span>; [| <span class="id" title="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.Znat.html#Nat2Z.id"><span class="id" title="lemma">Nat2Z.id</span></a> (<span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Peano.html#b3eea360671e1b32b18a26e15b3aace3"><span class="id" title="notation">+</span></a> <span class="id" title="var">_</span>)); <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="compcert.lib.Integers.html#Int.unsigned_repr"><span class="id" title="lemma">Int.unsigned_repr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.BinInt.html#Z.of_nat"><span class="id" title="definition">Z.of_nat</span></a> <span class="id" title="var">_</span>)); [<span class="id" title="tactic">reflexivity</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.ZArith.Znat.html#Nat2Z.inj_add"><span class="id" title="lemma">Nat2Z.inj_add</span></a>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <a class="idref" href="compcert.lib.Integers.html#Int.unsigned_repr"><span class="id" title="lemma">Int.unsigned_repr</span></a>; [<span class="id" title="var">eassumption</span> | <span class="id" title="tactic">omega</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <a class="idref" href="compcert.common.Memtype.html#Mem.store_outside_extends"><span class="id" title="method">Mem.store_outside_extends</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">abrel_match_mem_perms</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">constructor</span>; <span class="id" title="var">cbn</span>. <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">stack_counter_len0</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hstore</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="tutorial.stack.Stack.html#match_stack_store"><span class="id" title="lemma">match_stack_store</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">abrel_match_mem_perms</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">ofs</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span> <span class="id" title="var">H2</span> <span class="id" title="var">H3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">abrel_match_mem_perms</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">NP</span> &amp; <span class="id" title="var">P</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="compcert.common.Memtype.html#Mem.perm_store_1"><span class="id" title="method">Mem.perm_store_1</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> (<a class="idref" href="compcert.common.Memtype.html#Mem.nextblock_store"><span class="id" title="method">Mem.nextblock_store</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hstore</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="pop_refine"><span class="id" title="lemma">pop_refine</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_cprimitive"><span class="id" title="definition">pop_cprimitive</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">⊢</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Stack.html#stack_R"><span class="id" title="definition">stack_R</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">,</span></a> <a class="idref" href="liblayers.logic.Structures.html#1bcfff782645e550303b44d1d50df7a5"><span class="id" title="notation">∅</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">:</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_layer"><span class="id" title="definition">pop_layer</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
</div>

<div class="doc">
TUTORIAL: Try to prove this lemma. Something won't be quite right.
                    Fix the lemma statement, then complete your proof. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.LowHighSpecSim"><span class="id" title="section">LowHighSpecSim</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab688"></a><h2 class="section">Linking</h2>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a name="Stack.Linking"><span class="id" title="section">Linking</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="stack_L"><span class="id" title="definition">stack_L</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#clayer"><span class="id" title="abbreviation">clayer</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_layerdata"><span class="id" title="definition">stack_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Stack.html#get_size_layer"><span class="id" title="definition">get_size_layer</span></a> <a class="idref" href="liblayers.logic.Structures.html#64a6660c5ed3e47856f7e7c848c9c807"><span class="id" title="notation">⊕</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_layer"><span class="id" title="definition">push_layer</span></a> <a class="idref" href="liblayers.logic.Structures.html#64a6660c5ed3e47856f7e7c848c9c807"><span class="id" title="notation">⊕</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_layer"><span class="id" title="definition">pop_layer</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="4e22e16286669d8843ed8c1cef0080fa"><span class="id" title="definition">stack_Σ</span></a> : <a class="idref" href="liblayers.compcertx.CPrimitives.html#clayer"><span class="id" title="abbreviation">clayer</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_layerdata"><span class="id" title="definition">counter_layerdata</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="tutorial.stack.Stack.html#get_size"><span class="id" title="definition">get_size</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#get_size_cprimitive"><span class="id" title="definition">get_size_cprimitive</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.logic.Structures.html#64a6660c5ed3e47856f7e7c848c9c807"><span class="id" title="notation">⊕</span></a> <a class="idref" href="tutorial.stack.Stack.html#push"><span class="id" title="definition">push</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#push_cprimitive"><span class="id" title="definition">push_cprimitive</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.logic.Structures.html#64a6660c5ed3e47856f7e7c848c9c807"><span class="id" title="notation">⊕</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop"><span class="id" title="definition">pop</span></a> <a class="idref" href="liblayers.logic.Structures.html#33228780c4c171a6131f9e6e62ea2dd4"><span class="id" title="notation">↦</span></a> <a class="idref" href="tutorial.stack.Stack.html#pop_cprimitive"><span class="id" title="definition">pop_cprimitive</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="stack_M"><span class="id" title="definition">stack_M</span></a> : <a class="idref" href="liblayers.compcertx.ClightModules.html#cmodule"><span class="id" title="abbreviation">cmodule</span></a> := <a class="idref" href="tutorial.stack.Stack.html#Msize"><span class="id" title="definition">Msize</span></a> <a class="idref" href="liblayers.logic.Structures.html#64a6660c5ed3e47856f7e7c848c9c807"><span class="id" title="notation">⊕</span></a> <a class="idref" href="tutorial.stack.Stack.html#Mpush"><span class="id" title="definition">Mpush</span></a> <a class="idref" href="liblayers.logic.Structures.html#64a6660c5ed3e47856f7e7c848c9c807"><span class="id" title="notation">⊕</span></a> <a class="idref" href="tutorial.stack.Stack.html#Mpop"><span class="id" title="definition">Mpop</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">get_size_code</span> <span class="id" title="var">get_size_refine</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">push_code</span> <span class="id" title="var">push_refine</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pop_code</span> <span class="id" title="var">pop_refine</span> : <span class="id" title="var">linking</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">counter_pres_inv</span> : <span class="id" title="var">linking</span>.<br/>

<br/>
</div>

<div class="doc">
TUTORIAL: State and prove the linking theorem for Stack 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a name="stack_link"><span class="id" title="axiom">stack_link</span></a> : <span class="id" title="keyword">Prop</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="stack_pres_inv"><span class="id" title="lemma">stack_pres_inv</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.logic.Layers.html#ForallPrimitive"><span class="id" title="class">ForallPrimitive</span></a> <span class="id" title="var">_</span> (<a class="idref" href="liblayers.compcertx.CPrimitives.html#CPrimitivePreservesInvariant"><span class="id" title="class">CPrimitivePreservesInvariant</span></a> <span class="id" title="var">_</span>) <a class="idref" href="tutorial.stack.Stack.html#stack_L"><span class="id" title="definition">stack_L</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="tutorial.stack.Stack.html#stack_L"><span class="id" title="definition">stack_L</span></a>. <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
TUTORIAL: Uncomment this line once you've stated the linking theorem. 
</div>
<div class="code">

<br/>
</div>

<div class="doc">
The final result we want to prove is that the behaviors allowed by the
      stack high level primitives are refined by the counter and stack C code
      evaluated on the base (empty) layer. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a name="stack_counter_link"><span class="id" title="lemma">stack_counter_link</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="tutorial.stack.Counter.html#base_L"><span class="id" title="definition">base_L</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">⊢</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">(</span></a><a class="idref" href="tutorial.stack.Counter.html#counter_R"><span class="id" title="definition">counter_R</span></a> <a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">∘</span></a> <a class="idref" href="liblayers.simrel.SimrelInvariant.html#inv"><span class="id" title="definition">inv</span></a> <a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">∘</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_R"><span class="id" title="definition">stack_R</span></a> <a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">∘</span></a> <a class="idref" href="liblayers.simrel.SimrelInvariant.html#inv"><span class="id" title="definition">inv</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial.stack.Counter.html#counter_M"><span class="id" title="definition">counter_M</span></a> <a class="idref" href="liblayers.logic.Structures.html#64a6660c5ed3e47856f7e7c848c9c807"><span class="id" title="notation">⊕</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_M"><span class="id" title="definition">stack_M</span></a><a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">)</span></a> <a class="idref" href="liblayers.logic.Structures.html#02b32b237357d2b6b54537b4da97c51a"><span class="id" title="notation">:</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_L"><span class="id" title="definition">stack_L</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="liblayers.logic.Language.html#vdash_rel_equiv"><span class="id" title="method">vdash_rel_equiv</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<a class="idref" href="tutorial.stack.Counter.html#counter_R"><span class="id" title="definition">counter_R</span></a> <a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">∘</span></a> <a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">(</span></a><a class="idref" href="liblayers.simrel.SimrelInvariant.html#inv"><span class="id" title="definition">inv</span></a> <a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">∘</span></a> <a class="idref" href="tutorial.stack.Stack.html#stack_R"><span class="id" title="definition">stack_R</span></a> <a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">∘</span></a> <a class="idref" href="liblayers.simrel.SimrelInvariant.html#inv"><span class="id" title="definition">inv</span></a><a class="idref" href="liblayers.logic.Structures.html#28309b4b31fc061cea0bf998329431b2"><span class="id" title="notation">)</span></a>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="liblayers.logic.LayerData.html#cat_compose_assoc"><span class="id" title="method">cat_compose_assoc</span></a>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="liblayers.logic.LayerData.html#cat_compose_assoc"><span class="id" title="method">cat_compose_assoc</span></a>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="liblayers.logic.Language.html#vcomp_rule"><span class="id" title="method">vcomp_rule</span></a>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">linking</span>.<br/>
</div>

<div class="doc">
TUTORIAL: Change Admitted to Qed. If you've completed the exercises, it will probably just work. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack.Linking"><span class="id" title="section">Linking</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="tutorial.stack.Stack.html#Stack"><span class="id" title="section">Stack</span></a>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>