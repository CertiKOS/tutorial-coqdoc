<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>liblayers.lib.Monad</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library liblayers.lib.Monad</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="compcert.common.Errors.html#"><span class="id" title="library">compcert.common.Errors</span></a>. <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="liblayers.lib.ExtensionalityAxioms.html#"><span class="id" title="library">ExtensionalityAxioms</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="liblayers.lib.Functor.html#"><span class="id" title="library">Functor</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab316"></a><h1 class="section">Interface of monads</h1>

<div class="paragraph"> </div>

 As in Haskell, we define monads in terms of <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="projection">ret</span></a></span> and <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="projection">bind</span></a></span>.
  However we want to be able to use the corresponding <span class="inlinecode"><a class="idref" href="liblayers.lib.Functor.html#Functor"><span class="id" title="record">Functor</span></a></span>
  instances both independently and in the context of monads.
  To permit this, instead of defining a generic <span class="inlinecode"><a class="idref" href="liblayers.lib.Functor.html#Functor"><span class="id" title="record">Functor</span></a></span> instance
  for all monads, we require a priori that monads be functors,
  then define the relationship between <span class="inlinecode"><a class="idref" href="liblayers.lib.Functor.html#fmap"><span class="id" title="projection">fmap</span></a></span>, <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="projection">ret</span></a></span> and <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="projection">bind</span></a></span>
  as the <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#monad_fmap"><span class="id" title="projection">monad_fmap</span></a></span> equation in the <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="record">Monad</span></a></span> class. This way,
  code need not depend on this module when they use, say, <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a></span>
  as a simple <span class="inlinecode"><a class="idref" href="liblayers.lib.Functor.html#Functor"><span class="id" title="record">Functor</span></a></span> rather than a full-blown <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="record">Monad</span></a></span>.
  In addition, <span class="inlinecode"><a class="idref" href="liblayers.logic.Structures.html#id"><span class="id" title="projection">id</span></a></span> for instance is both a <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="record">Monad</span></a></span> and <span class="inlinecode"><span class="id" title="var">Comonad</span></span>,
  but we do not want to derive two separate instances of the
  corresponding <span class="inlinecode"><a class="idref" href="liblayers.lib.Functor.html#Functor"><span class="id" title="record">Functor</span></a></span>.

<div class="paragraph"> </div>

  XXX: document tactics, and when to use unfold vs. simpl
  vs. autorewrite vs. inv_monad. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="MonadOps"><span class="id" title="record">MonadOps</span></a> (<span class="id" title="var">M</span>: <span class="id" title="keyword">Type</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">Mfmap</span>: <a class="idref" href="liblayers.lib.Functor.html#FunctorOps"><span class="id" title="class">FunctorOps</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a>} := {<br/>
&nbsp;&nbsp;<a name="ret"><span class="id" title="projection">ret</span></a> {<span class="id" title="var">A</span>}: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>;<br/>
&nbsp;&nbsp;<a name="bind"><span class="id" title="projection">bind</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>}: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">(</span></a><a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a><br/>
}.<br/>

<br/>
<span class="id" title="keyword">Notation</span> <a name="9de03680d7b45b7f84bb39e0173c68a2"><span class="id" title="notation">&quot;</span></a>x &lt;- M ; N" := (<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">N</span>) <span class="id" title="var">M</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
<span class="id" title="keyword">Class</span> <a name="Monad"><span class="id" title="record">Monad</span></a> (<span class="id" title="var">M</span>: <span class="id" title="keyword">Type</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">Mops</span>: <a class="idref" href="liblayers.lib.Monad.html#MonadOps"><span class="id" title="class">MonadOps</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a>}: <span class="id" title="keyword">Prop</span> := {<br/>
&nbsp;&nbsp;<a name="monad_functor"><span class="id" title="projection">monad_functor</span></a> :&gt; <a class="idref" href="liblayers.lib.Functor.html#Functor"><span class="id" title="class">Functor</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a>;<br/>
&nbsp;&nbsp;<a name="monad_fmap"><span class="id" title="projection">monad_fmap</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Functor.html#fmap"><span class="id" title="method">fmap</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> (<a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a>));<br/>
&nbsp;&nbsp;<a name="monad_ret_bind"><span class="id" title="projection">monad_ret_bind</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">x</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> (<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a>;<br/>
&nbsp;&nbsp;<a name="monad_bind_ret"><span class="id" title="projection">monad_bind_ret</span></a> {<span class="id" title="var">A</span>} (<span class="id" title="var">m</span>: <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#m"><span class="id" title="variable">m</span></a>;<br/>
&nbsp;&nbsp;<a name="monad_bind_bind"><span class="id" title="projection">monad_bind_bind</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>} (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#C"><span class="id" title="variable">C</span></a>) (<span class="id" title="var">g</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">m</span>: <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> (<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#g"><span class="id" title="variable">g</span></a> <a class="idref" href="liblayers.lib.Monad.html#m"><span class="id" title="variable">m</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> (<a class="idref" href="liblayers.lib.Monad.html#g"><span class="id" title="variable">g</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a>)) <a class="idref" href="liblayers.lib.Monad.html#m"><span class="id" title="variable">m</span></a><br/>
}.<br/>

<br/>
</div>

<div class="doc">
Some monads provide some of these inversion properties. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="MonadInvRet"><span class="id" title="record">MonadInvRet</span></a> <span class="id" title="var">M</span> `{<span class="id" title="var">Mops</span>: <a class="idref" href="liblayers.lib.Monad.html#MonadOps"><span class="id" title="class">MonadOps</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a>} :=<br/>
&nbsp;&nbsp;<a name="monad_inv_ret"><span class="id" title="projection">monad_inv_ret</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#y"><span class="id" title="variable">y</span></a>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a name="MonadInvBind"><span class="id" title="record">MonadInvBind</span></a> <span class="id" title="var">M</span> `{<span class="id" title="var">Mops</span>: <a class="idref" href="liblayers.lib.Monad.html#MonadOps"><span class="id" title="class">MonadOps</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a>} :=<br/>
&nbsp;&nbsp;<a name="monad_inv_bind_extract"><span class="id" title="projection">monad_inv_bind_extract</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">ma</span>: <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">b</span>: <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#ma"><span class="id" title="variable">ma</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Specif.html#5b63cb9ed0fed82566685c66e56592e4"><span class="id" title="notation">{</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Specif.html#5b63cb9ed0fed82566685c66e56592e4"><span class="id" title="notation">|</span></a> <a class="idref" href="liblayers.lib.Monad.html#ma"><span class="id" title="variable">ma</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Specif.html#5b63cb9ed0fed82566685c66e56592e4"><span class="id" title="notation">}</span></a>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a name="MonadInvBindWeak"><span class="id" title="record">MonadInvBindWeak</span></a> <span class="id" title="var">M</span> `{<span class="id" title="var">Mops</span>: <a class="idref" href="liblayers.lib.Monad.html#MonadOps"><span class="id" title="class">MonadOps</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a>} :=<br/>
&nbsp;&nbsp;<a name="monad_inv_bind_weak"><span class="id" title="projection">monad_inv_bind_weak</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">ma</span>: <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">b</span>: <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#ma"><span class="id" title="variable">ma</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">∃</span></a> <span class="id" title="var">a</span><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">,</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#b"><span class="id" title="variable">b</span></a>.<br/>

<br/>
</div>

<div class="doc">
The relators and/or other relation operators corresponding to the
  monad's underlying type operator should be declared compatible with
  the monadic structure using the following interface. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="coqrel.LogicalRelations.html#"><span class="id" title="library">LogicalRelations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <a name="MonadRel"><span class="id" title="record">MonadRel</span></a> `{<a class="idref" href="liblayers.lib.Monad.html#MonadOps"><span class="id" title="class">MonadOps</span></a>} (<span class="id" title="var">Mr</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>, <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> (<a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>) (<a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>)) :=<br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="ret_rel"><span class="id" title="projection">ret_rel</span></a> :&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">forallr</span></a> <span class="id" title="var">R</span><a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">,</span></a> <span class="id" title="var">R</span> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">++&gt;</span></a> <a class="idref" href="liblayers.lib.Monad.html#Mr"><span class="id" title="variable">Mr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="bind_rel"><span class="id" title="projection">bind_rel</span></a> :&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">forallr</span></a> <span class="id" title="var">RA</span><a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">,</span></a> <a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">forallr</span></a> <span class="id" title="var">RB</span><a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">,</span></a> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">(</span></a><span class="id" title="var">RA</span> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">++&gt;</span></a> <a class="idref" href="liblayers.lib.Monad.html#Mr"><span class="id" title="variable">Mr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">RB</span><a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">)</span></a> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">++&gt;</span></a> <a class="idref" href="liblayers.lib.Monad.html#Mr"><span class="id" title="variable">Mr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">RA</span> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">++&gt;</span></a> <a class="idref" href="liblayers.lib.Monad.html#Mr"><span class="id" title="variable">Mr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">RB</span>)<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="ret_rel_params"><span class="id" title="instance">ret_rel_params</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> (@<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a>) 2.<br/>
<span class="id" title="keyword">Global Instance</span> <a name="bind_rel_params"><span class="id" title="instance">bind_rel_params</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> (@<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a>) 4.<br/>

<br/>
</div>

<div class="doc">
Note that it is very easy for <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> to switch the monad
  operations <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="projection">ret</span></a></span> and <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="projection">bind</span></a></span> to their concrete implementations,
  which may break some of the tactics below. To work around this, in
  <span class="inlinecode"><span class="id" title="var">inv_monad</span></span> we attempt to "refold" some well-known implementations
  into <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="projection">ret</span></a></span> and <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="projection">bind</span></a></span> form before we proceed.  However, this is not
  a very modular approach.

<div class="paragraph"> </div>

  There is not a very good solution to this problem. We could define
  our operations as parameters for the typeclass, to be recognized
  "in the wild" instead of providing a uniform <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="projection">ret</span></a></span>/<span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="projection">bind</span></a></span> notation,
  but this would for instance make it very slow to scan a goal for
  possible rewrites involving the monad laws. Instead, we rely on the
  user to be parcimonious with the <span class="inlinecode"><span class="id" title="tactic">simpl</span></span> tactic and only apply it as
  necessary, in a restricted way.

<div class="paragraph"> </div>

  If necessary, you can locally disable the simplification of <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="projection">bind</span></a></span>
  and <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="projection">ret</span></a></span> using the following vernacular commands:

<div class="paragraph"> </div>

      Local Arguments ret : simpl never.
      Local Arguments bind : simpl never.
 
<div class="paragraph"> </div>

<a name="lab317"></a><h1 class="section">Normalization</h1>

<div class="paragraph"> </div>

 Using the theorem in <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="record">Monad</span></a></span>, we can try to normalize monadic
  expressions to the form <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode">&lt;-</span> <span class="inlinecode"><a class="idref" href="liblayers.logic.Modules.html#M1"><span class="id" title="variable">M1</span></a>;</span> <span class="inlinecode"><a class="idref" href="compcert.lib.Coqlib.html#x2"><span class="id" title="variable">x2</span></a></span> <span class="inlinecode">&lt;-</span> <span class="inlinecode"><a class="idref" href="liblayers.logic.Modules.html#M2"><span class="id" title="variable">M2</span></a>;</span> <span class="inlinecode">...;</span> <span class="inlinecode"><a class="idref" href="tutorial.queue.AbsQueue.html#xn"><span class="id" title="variable">xn</span></a></span> <span class="inlinecode">&lt;-</span> <span class="inlinecode"><span class="id" title="var">Mn</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Hint Rewrite</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="liblayers.lib.Monad.html#monad_ret_bind"><span class="id" title="method">monad_ret_bind</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="liblayers.lib.Monad.html#monad_bind_ret"><span class="id" title="method">monad_bind_ret</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<a class="idref" href="liblayers.lib.Monad.html#monad_bind_bind"><span class="id" title="method">monad_bind_bind</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">using</span> <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span> : <span class="id" title="var">monad</span>.<br/>

<br/>
</div>

<div class="doc">
Unfortunately, the <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#MonadOps"><span class="id" title="record">MonadOps</span></a></span> instance in <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#monad_fmap"><span class="id" title="projection">monad_fmap</span></a></span> cannot
  be obtained by unification when matching the left-hand side of
  the rewrite with the current goal. Since the <span class="inlinecode"><span class="id" title="tactic">autorewrite</span></span> tactic
  does not do type class resolution, we cannot use <span class="inlinecode"><a class="idref" href="liblayers.lib.Monad.html#monad_fmap"><span class="id" title="projection">monad_fmap</span></a></span>
  as a rewrite rule. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rewrite_monad_fmap</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ <span class="id" title="var">H</span>: <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="tactic">rewrite</span> <a class="idref" href="liblayers.lib.Monad.html#monad_fmap"><span class="id" title="method">monad_fmap</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span> <span class="id" title="keyword">end</span> ||<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="liblayers.lib.Monad.html#monad_fmap"><span class="id" title="method">monad_fmap</span></a>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">monad_norm</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">rewrite_monad_fmap</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">monad</span> <span class="id" title="keyword">in</span> ×.<br/>

<br/>
</div>

<div class="doc">
<a name="lab318"></a><h1 class="section">Monad inversion</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a name="MONADINV"><span class="id" title="section">MONADINV</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">HM</span>: <a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="class">Monad</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">HMbind</span>: !<a class="idref" href="liblayers.lib.Monad.html#MonadInvBind"><span class="id" title="class">MonadInvBind</span></a> <a class="idref" href="liblayers.lib.Monad.html#MONADINV.M"><span class="id" title="variable">M</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">HMret</span>: !<a class="idref" href="liblayers.lib.Monad.html#MonadInvRet"><span class="id" title="class">MonadInvRet</span></a> <a class="idref" href="liblayers.lib.Monad.html#MONADINV.M"><span class="id" title="variable">M</span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="monad_inv_bind_inv_bind_weak"><span class="id" title="instance">monad_inv_bind_inv_bind_weak</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#MonadInvBindWeak"><span class="id" title="class">MonadInvBindWeak</span></a> <a class="idref" href="liblayers.lib.Monad.html#MONADINV.M"><span class="id" title="variable">M</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span> <span class="id" title="var">ma</span> <span class="id" title="var">b</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="liblayers.lib.Monad.html#monad_inv_bind_extract"><span class="id" title="definition">monad_inv_bind_extract</span></a> <span class="id" title="var">f</span> <span class="id" title="var">ma</span> <span class="id" title="var">b</span> <span class="id" title="var">H</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">a</span> <span class="id" title="var">Ha</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="monad_inv_bind"><span class="id" title="lemma">monad_inv_bind</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#MONADINV.M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">ma</span>: <a class="idref" href="liblayers.lib.Monad.html#MONADINV.M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">b</span>: <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#ma"><span class="id" title="variable">ma</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Specif.html#5b63cb9ed0fed82566685c66e56592e4"><span class="id" title="notation">{</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Specif.html#5b63cb9ed0fed82566685c66e56592e4"><span class="id" title="notation">|</span></a> <a class="idref" href="liblayers.lib.Monad.html#ma"><span class="id" title="variable">ma</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Specif.html#5b63cb9ed0fed82566685c66e56592e4"><span class="id" title="notation">}</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="liblayers.lib.Monad.html#monad_inv_bind_extract"><span class="id" title="definition">monad_inv_bind_extract</span></a> <span class="id" title="var">f</span> <span class="id" title="var">ma</span> <span class="id" title="var">b</span> <span class="id" title="var">H</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">a</span> <span class="id" title="var">Ha</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="monad_inv_bind_iff"><span class="id" title="lemma">monad_inv_bind_iff</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#MONADINV.M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">ma</span>: <a class="idref" href="liblayers.lib.Monad.html#MONADINV.M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">b</span>: <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#ma"><span class="id" title="variable">ma</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#b"><span class="id" title="variable">b</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#df1ced36fc33ce188051218bca314374"><span class="id" title="notation">↔</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">∃</span></a> <span class="id" title="var">a</span><a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d8"><span class="id" title="notation">,</span></a> <a class="idref" href="liblayers.lib.Monad.html#ma"><span class="id" title="variable">ma</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="liblayers.lib.Monad.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#b"><span class="id" title="variable">b</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="liblayers.lib.Monad.html#monad_inv_bind"><span class="id" title="lemma">monad_inv_bind</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> [<span class="id" title="var">Hma</span> <span class="id" title="var">Hfa</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="monad_inv_ret_iff"><span class="id" title="lemma">monad_inv_ret_iff</span></a> {<span class="id" title="var">A</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="liblayers.lib.Monad.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#df1ced36fc33ce188051218bca314374"><span class="id" title="notation">↔</span></a> <a class="idref" href="liblayers.lib.Monad.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#y"><span class="id" title="variable">y</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="liblayers.lib.Monad.html#monad_inv_ret"><span class="id" title="definition">monad_inv_ret</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#f_equal"><span class="id" title="lemma">f_equal</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="liblayers.lib.Monad.html#MONADINV"><span class="id" title="section">MONADINV</span></a>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">inv_monad</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="var">type</span> <span class="id" title="var">of</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">context</span> <span class="id" title="var">C</span>[<a class="idref" href="compcert.common.Errors.html#OK"><span class="id" title="constructor">Errors.OK</span></a> ?<span class="id" title="var">x</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<a class="idref" href="compcert.common.Errors.html#OK"><span class="id" title="constructor">OK</span></a> <span class="id" title="var">x</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> (<span class="id" title="var">M</span>:=<a class="idref" href="compcert.common.Errors.html#res"><span class="id" title="inductive">res</span></a>) <span class="id" title="var">x</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">context</span> <span class="id" title="var">C</span>[@<a class="idref" href="compcert.common.Errors.html#bind"><span class="id" title="definition">Errors.bind</span></a> ?<span class="id" title="var">A</span> ?<span class="id" title="var">B</span> ?<span class="id" title="var">ra</span> ?<span class="id" title="var">f</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (@<a class="idref" href="compcert.common.Errors.html#bind"><span class="id" title="definition">Errors.bind</span></a> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">ra</span> <span class="id" title="var">f</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> (<span class="id" title="var">M</span>:=<a class="idref" href="compcert.common.Errors.html#res"><span class="id" title="inductive">res</span></a>) (<span class="id" title="var">A</span>:=<span class="id" title="var">A</span>) (<span class="id" title="var">B</span>:=<span class="id" title="var">B</span>) <span class="id" title="var">f</span> <span class="id" title="var">ra</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">context</span> <span class="id" title="var">C</span>[@<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ?<span class="id" title="var">A</span> ?<span class="id" title="var">x</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (@<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">A</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> (<span class="id" title="var">M</span>:=<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a>) (<span class="id" title="var">A</span>:=<span class="id" title="var">A</span>) <span class="id" title="var">x</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">type</span> <span class="id" title="var">of</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> ?<span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> ?<span class="id" title="var">y</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="liblayers.lib.Monad.html#monad_inv_ret"><span class="id" title="definition">monad_inv_ret</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> ?<span class="id" title="var">mb</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> ?<span class="id" title="var">f</span> ?<span class="id" title="var">ma</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">H</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> ?<span class="id" title="var">f</span> ?<span class="id" title="var">ma</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> ?<span class="id" title="var">mb</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">H1</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">H2</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="liblayers.lib.Monad.html#monad_inv_bind"><span class="id" title="lemma">monad_inv_bind</span></a> <span class="id" title="var">f</span> <span class="id" title="var">ma</span> <span class="id" title="var">mb</span> <span class="id" title="var">H</span>) <span class="id" title="keyword">as</span> [? [<span class="id" title="var">H1</span> <span class="id" title="var">H2</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">H2</span> <span class="id" title="var">into</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">inv_monad</span> <span class="id" title="var">H1</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inv_monad</span> <span class="id" title="var">H</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> ?<span class="id" title="var">f</span> ?<span class="id" title="var">ma</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> ?<span class="id" title="var">mb</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="liblayers.lib.Monad.html#monad_inv_bind_weak"><span class="id" title="definition">monad_inv_bind_weak</span></a> <span class="id" title="var">f</span> <span class="id" title="var">ma</span> <span class="id" title="var">mb</span> <span class="id" title="var">H</span>) <span class="id" title="keyword">as</span> [? ?]<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab319"></a><h1 class="section">Properties</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="monad_bind_fmap"><span class="id" title="lemma">monad_bind_fmap</span></a> `{<a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="class">Monad</span></a>} {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>} (<span class="id" title="var">m</span>: <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">f</span>: <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#C"><span class="id" title="variable">C</span></a>) (<span class="id" title="var">g</span>: <a class="idref" href="liblayers.lib.Monad.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <a class="idref" href="liblayers.lib.Monad.html#B"><span class="id" title="variable">B</span></a>):<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> <a class="idref" href="liblayers.lib.Monad.html#9de03680d7b45b7f84bb39e0173c68a2"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="liblayers.lib.Monad.html#m"><span class="id" title="variable">m</span></a><a class="idref" href="liblayers.lib.Monad.html#9de03680d7b45b7f84bb39e0173c68a2"><span class="id" title="notation">;</span></a> <a class="idref" href="liblayers.lib.Functor.html#fmap"><span class="id" title="method">fmap</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> (<a class="idref" href="liblayers.lib.Monad.html#g"><span class="id" title="variable">g</span></a> <span class="id" title="var">x</span>) <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Functor.html#fmap"><span class="id" title="method">fmap</span></a> <a class="idref" href="liblayers.lib.Monad.html#f"><span class="id" title="variable">f</span></a> (<span class="id" title="var">x</span> <a class="idref" href="liblayers.lib.Monad.html#9de03680d7b45b7f84bb39e0173c68a2"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="liblayers.lib.Monad.html#m"><span class="id" title="variable">m</span></a><a class="idref" href="liblayers.lib.Monad.html#9de03680d7b45b7f84bb39e0173c68a2"><span class="id" title="notation">;</span></a> <a class="idref" href="liblayers.lib.Monad.html#g"><span class="id" title="variable">g</span></a> <span class="id" title="var">x</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">monad_norm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="fmap_rel"><span class="id" title="instance">fmap_rel</span></a> `{<span class="id" title="var">HMr</span>: <a class="idref" href="liblayers.lib.Monad.html#MonadRel"><span class="id" title="class">MonadRel</span></a>} `{<span class="id" title="var">HM</span>: !<a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="class">Monad</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a>}:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(@<a class="idref" href="liblayers.lib.Functor.html#fmap"><span class="id" title="method">fmap</span></a> <a class="idref" href="liblayers.lib.Monad.html#M"><span class="id" title="variable">M</span></a> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">forallr</span></a> <span class="id" title="var">RA</span><a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">,</span></a> <a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">forallr</span></a> <span class="id" title="var">RB</span><a class="idref" href="coqrel.RelDefinitions.html#1bd22793714b33e291f1b6c3b141e214"><span class="id" title="notation">,</span></a> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">(</span></a><span class="id" title="var">RA</span> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">++&gt;</span></a> <span class="id" title="var">RB</span><a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">)</span></a> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">++&gt;</span></a> <a class="idref" href="liblayers.lib.Monad.html#Mr"><span class="id" title="variable">Mr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">RA</span> <a class="idref" href="coqrel.RelDefinitions.html#d5d0ad6beccd25d5224442d64ed307d5"><span class="id" title="notation">++&gt;</span></a> <a class="idref" href="liblayers.lib.Monad.html#Mr"><span class="id" title="variable">Mr</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">RB</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">rstep</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<a class="idref" href="liblayers.lib.Monad.html#monad_fmap"><span class="id" title="method">monad_fmap</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab320"></a><h1 class="section">Some instances</h1>

<div class="paragraph"> </div>

 The unit monad is interesting because it is an example of a monad
  which accepts none of the inversion properties defined earlier. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a name="CONST_UNIT"><span class="id" title="section">CONST_UNIT</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="const_unit_monad_ops"><span class="id" title="instance">const_unit_monad_ops</span></a>: <a class="idref" href="liblayers.lib.Monad.html#MonadOps"><span class="id" title="class">MonadOps</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">X</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>) := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span> <span class="id" title="var">mx</span> := <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <span class="id" title="var">A</span> <span class="id" title="var">x</span> := <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="const_unit_monad"><span class="id" title="instance">const_unit_monad</span></a>: <a class="idref" href="liblayers.lib.Monad.html#Monad"><span class="id" title="class">Monad</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">X</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">unfold</span> <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a>, <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> ? <span class="id" title="var">_</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="const_unit_no_inv_ret"><span class="id" title="lemma">const_unit_no_inv_ret</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#611abc97cba304de784fa909dbdea1fa"><span class="id" title="notation">¬</span></a> <a class="idref" href="liblayers.lib.Monad.html#MonadInvRet"><span class="id" title="class">MonadInvRet</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span>: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#32263a1c8b01baecdff9deb038955bc9"><span class="id" title="notation">≠</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="liblayers.lib.Monad.html#monad_inv_ret"><span class="id" title="definition">monad_inv_ret</span></a> (<span class="id" title="var">M</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>), (<a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="const_unit_no_inv_weak_bind"><span class="id" title="lemma">const_unit_no_inv_weak_bind</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#611abc97cba304de784fa909dbdea1fa"><span class="id" title="notation">¬</span></a> <a class="idref" href="liblayers.lib.Monad.html#MonadInvBindWeak"><span class="id" title="class">MonadInvBindWeak</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hinv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Empty_set_rect"><span class="id" title="definition">Empty_set_rect</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#Empty_set"><span class="id" title="inductive">Empty_set</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#unit"><span class="id" title="inductive">unit</span></a>) <span class="id" title="keyword">as</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span>: <a class="idref" href="liblayers.lib.Monad.html#bind"><span class="id" title="method">bind</span></a> <span class="id" title="var">f</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="liblayers.lib.Monad.html#ret"><span class="id" title="method">ret</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6/stdlib/Coq.Init.Datatypes.html#tt"><span class="id" title="constructor">tt</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="liblayers.lib.Monad.html#monad_inv_bind_weak"><span class="id" title="definition">monad_inv_bind_weak</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">x</span> <span class="id" title="var">_</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">elim</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="liblayers.lib.Monad.html#CONST_UNIT"><span class="id" title="section">CONST_UNIT</span></a>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>